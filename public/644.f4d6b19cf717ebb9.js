"use strict";(self.webpackChunkcustomer=self.webpackChunkcustomer||[]).push([[644],{6644:(L,g,o)=>{o.r(g),o.d(g,{CheckoutModule:()=>p});var a=o(6895),d=o(5467),i=o(433),f=o(5931),v=o(5698),h=o(3572),Z=o(3629),P=o(9653),t=o(4650),F=o(3900),A=o(529);class l{constructor(e,r){this.http=e,this.router=r,this.API_URL=Z.N.API_URL}postMyPlaceOrder(e,r){return this.http.post(`${this.API_URL}/myorder/placeorder/${e}`,{price:r}).pipe((0,F.w)(({url:c})=>window.location.href=c))}getMyPlaceOrder(e){return this.http.get(`${this.API_URL}/myorder/placeorder/${e}`)}patchCheckout(e,r){return this.http.patch(`${this.API_URL}/myorder/checkout/${e}`,{token:r}).toPromise()}getConfirmOrder(e){return this.http.get(`${this.API_URL}/myorder/confirm/${e}`)}static#t=this.\u0275fac=function(r){return new(r||l)(t.LFG(A.eN),t.LFG(d.F0))};static#r=this.\u0275prov=t.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}var b=o(3248);class m{constructor(e){this.router=e}ngOnInit(){}redirect(){this.router.navigate(["/app/books"])}static#t=this.\u0275fac=function(r){return new(r||m)(t.Y36(d.F0))};static#r=this.\u0275cmp=t.Xpm({type:m,selectors:[["frontend-logo-header"]],decls:4,vars:0,consts:[[1,"header-container"],[1,"header"],[1,"logo-container",3,"click"],["src","../../assets/word@2x.png","alt","",1,"logo"]],template:function(r,c){1&r&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.NdJ("click",function(){return c.redirect()}),t._UZ(3,"img",3),t.qZA()()())},encapsulation:2})}function x(n,e){1&n&&(t.TgZ(0,"small",20),t._uU(1,"*Price is required "),t.qZA())}function T(n,e){if(1&n){const r=t.EpF();t.ynx(0),t.TgZ(1,"div",4),t._UZ(2,"frontend-card-book",5),t.qZA(),t.TgZ(3,"div",6)(4,"div",7)(5,"div",8)(6,"h3"),t._uU(7,"Please fill in the required information"),t.qZA()(),t.TgZ(8,"form",9)(9,"div",10)(10,"label",11),t._uU(11,"Price"),t.qZA(),t.TgZ(12,"div",12)(13,"input",13),t.NdJ("blur",function(){t.CHM(r);const s=t.oxw();return t.KtG(s.getPriceFormated())}),t.qZA(),t.TgZ(14,"span",14),t._uU(15,"USD"),t.qZA()(),t.YNc(16,x,2,0,"small",15),t.qZA()()(),t.TgZ(17,"div",16)(18,"div",8)(19,"h3"),t._uU(20,"Order Summary"),t.qZA()(),t.TgZ(21,"table",17)(22,"tr")(23,"th"),t._uU(24),t.ALo(25,"titlecase"),t.qZA(),t.TgZ(26,"td"),t._uU(27),t.ALo(28,"currency"),t.qZA()(),t.TgZ(29,"tr")(30,"th"),t._uU(31,"Delivery"),t.qZA(),t.TgZ(32,"td"),t._uU(33,"FREE"),t.qZA()(),t.TgZ(34,"tr")(35,"th"),t._uU(36,"Total to pay"),t.qZA(),t.TgZ(37,"td"),t._uU(38),t.ALo(39,"currency"),t.qZA()()()(),t.TgZ(40,"div",18)(41,"button",19),t.NdJ("click",function(){t.CHM(r);const s=t.oxw();return t.KtG(s.onSubmit())}),t._uU(42," Continue to Payment "),t.qZA()()(),t.BQk()}if(2&n){const r=t.oxw();t.xp6(2),t.Q6J("book",r.book),t.xp6(6),t.Q6J("formGroup",r.orderForm),t.xp6(8),t.Q6J("ngIf",r.validateCamp("price")),t.xp6(8),t.Oqu(t.lcZ(25,7,r.book.name)),t.xp6(3),t.Oqu(t.lcZ(28,9,r.price)),t.xp6(11),t.Oqu(t.lcZ(39,11,r.price)),t.xp6(3),t.Q6J("disabled",r.orderForm.invalid||r.orderForm.disabled)}}function k(n,e){1&n&&t._UZ(0,"div",22)}const U=function(){return[0,1,2]};function y(n,e){1&n&&t.YNc(0,k,1,0,"div",21),2&n&&t.Q6J("ngForOf",t.DdM(1,U))}class u{constructor(e,r,c,s,_,O,I,Y){this.formBuilder=e,this.location=r,this.route=c,this.bookBaseService=s,this.checkoutService=_,this.alertService=O,this.router=I,this.store=Y,this.RAW_URL=Z.N.RAW_URL,this.couponForm=new i.NI(""),this.checkoutComplete=!1,this.init=!1}ngOnInit(){this._getBook()}back(){this.location.back()}_initForm(e,r){this.orderForm=this.formBuilder.group({price:[e,[i.kI.required,i.kI.min(e),i.kI.max(r)]]})}onSubmit(){this.orderForm.invalid?this.orderForm.markAllAsTouched():this.checkoutService.postMyPlaceOrder(this.id,this.price).subscribe(e=>{e&&this.alertService.fire({text:"Something wrong have happened",icon:"error"})})}onSubmitCoupon(){this.couponForm.markAsTouched()}_getBook(){this.route.params.pipe((0,v.q)(1)).subscribe(e=>{e.id&&(this.id=e.id,this.store.pipe((0,P.Ys)((0,h.NK)(this.id)),(0,v.q)(1)).subscribe(r=>{r&&(this.book=r,this.minPrice=this.book.minPrice,this.maxPrice=this.book.maxPrice,this.price=this.book.minPrice,this._initForm(this.minPrice,this.maxPrice),this.init=!0)}))})}validateCamp(e){return this.orderForm.controls[e].errors&&this.orderForm.controls[e].touched}validateCoupon(){return this.couponForm.touched}getPrice(){return this.orderForm.get("price")?.value}getPriceFormated(){!this.getPrice()||this.orderForm.get("price")?.value<this.minPrice?(this.price=this.minPrice,this.orderForm.patchValue({price:this.minPrice})):this.orderForm.get("price")?.value>this.maxPrice?(this.price=this.maxPrice,this.orderForm.patchValue({price:this.maxPrice})):this.price=this.getPrice()}static#t=this.\u0275fac=function(r){return new(r||u)(t.Y36(i.qu),t.Y36(a.Ye),t.Y36(d.gz),t.Y36(h.db),t.Y36(l),t.Y36(f.c9),t.Y36(d.F0),t.Y36(P.yh))};static#r=this.\u0275cmp=t.Xpm({type:u,selectors:[["frontend-place-order"]],decls:6,vars:2,consts:[[1,"main-container"],[1,"place-order-container"],[4,"ngIf","ngIfElse"],["loading",""],[1,"card-book-container"],[3,"book"],[1,"cards-container"],[1,"card-form-container"],[1,"card-header"],[1,"form-container",3,"formGroup"],[1,"input-label"],["for","price",1,"label"],[1,"input-split"],["type","number","id","price","formControlName","price","min","0","maxlength","6",1,"input",3,"blur"],[1,"input-text"],["class","ml-2 p-error",4,"ngIf"],[1,"card-summary"],[1,"card-table"],[1,"button-container"],[1,"button-primary",2,"height","35px",3,"disabled","click"],[1,"ml-2","p-error"],["class","card-loading",4,"ngFor","ngForOf"],[1,"card-loading"]],template:function(r,c){if(1&r&&(t.TgZ(0,"div",0),t._UZ(1,"frontend-logo-header"),t.TgZ(2,"div",1),t.YNc(3,T,43,13,"ng-container",2),t.qZA()(),t.YNc(4,y,1,2,"ng-template",null,3,t.W1O)),2&r){const s=t.MAs(5);t.xp6(3),t.Q6J("ngIf",c.init)("ngIfElse",s)}},dependencies:[b.b,a.sg,a.O5,i._Y,i.Fj,i.wV,i.JJ,i.JL,i.nD,i.qQ,i.sg,i.u,m,a.rS,a.H9],encapsulation:2})}const C=[{path:"placeorder/:id",component:u,resolve:{books:h.Kt}}];class p{static#t=this.\u0275fac=function(r){return new(r||p)};static#r=this.\u0275mod=t.oAB({type:p});static#e=this.\u0275inj=t.cJS({imports:[h.rG,a.ez,i.UX,f.As,d.Bz.forChild(C)]})}}}]);